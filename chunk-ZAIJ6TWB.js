import{$ as O,Ga as ie,Va as L,Wa as W,Xa as F,Ya as se,_ as T,_a as j,a as te,ab as oe,bb as ae,c as he,cb as le,d as ue,db as P}from"./chunk-YTHRDBAW.js";var de=he((ee,ne)=>{"use strict";(function(Q,m){typeof ee=="object"&&typeof ne=="object"?ne.exports=m():typeof define=="function"&&define.amd?define([],m):typeof ee=="object"?ee.Drawflow=m():Q.Drawflow=m()})(typeof self<"u"?self:ee,function(){return function(Q){var m={};function g(f){if(m[f])return m[f].exports;var w=m[f]={i:f,l:!1,exports:{}};return Q[f].call(w.exports,w,w.exports,g),w.l=!0,w.exports}return g.m=Q,g.c=m,g.d=function(f,w,e){g.o(f,w)||Object.defineProperty(f,w,{enumerable:!0,get:e})},g.r=function(f){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(f,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(f,"__esModule",{value:!0})},g.t=function(f,w){if(1&w&&(f=g(f)),8&w||4&w&&typeof f=="object"&&f&&f.__esModule)return f;var e=Object.create(null);if(g.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:f}),2&w&&typeof f!="string")for(var t in f)g.d(e,t,function(s){return f[s]}.bind(null,t));return e},g.n=function(f){var w=f&&f.__esModule?function(){return f.default}:function(){return f};return g.d(w,"a",w),w},g.o=function(f,w){return Object.prototype.hasOwnProperty.call(f,w)},g.p="",g(g.s=0)}([function(Q,m,g){"use strict";g.r(m),g.d(m,"default",function(){return f});class f{constructor(e,t=null,s=null){this.events={},this.container=e,this.precanvas=null,this.nodeId=1,this.ele_selected=null,this.node_selected=null,this.drag=!1,this.reroute=!1,this.reroute_fix_curvature=!1,this.curvature=.5,this.reroute_curvature_start_end=.5,this.reroute_curvature=.5,this.reroute_width=6,this.drag_point=!1,this.editor_selected=!1,this.connection=!1,this.connection_ele=null,this.connection_selected=null,this.canvas_x=0,this.canvas_y=0,this.pos_x=0,this.pos_x_start=0,this.pos_y=0,this.pos_y_start=0,this.mouse_x=0,this.mouse_y=0,this.line_path=5,this.first_click=null,this.force_first_input=!1,this.draggable_inputs=!0,this.useuuid=!1,this.parent=s,this.noderegister={},this.render=t,this.drawflow={drawflow:{Home:{data:{}}}},this.module="Home",this.editor_mode="edit",this.zoom=1,this.zoom_max=1.6,this.zoom_min=.5,this.zoom_value=.1,this.zoom_last_value=1,this.evCache=new Array,this.prevDiff=-1}start(){this.container.classList.add("parent-drawflow"),this.container.tabIndex=0,this.precanvas=document.createElement("div"),this.precanvas.classList.add("drawflow"),this.container.appendChild(this.precanvas),this.container.addEventListener("mouseup",this.dragEnd.bind(this)),this.container.addEventListener("mousemove",this.position.bind(this)),this.container.addEventListener("mousedown",this.click.bind(this)),this.container.addEventListener("touchend",this.dragEnd.bind(this)),this.container.addEventListener("touchmove",this.position.bind(this)),this.container.addEventListener("touchstart",this.click.bind(this)),this.container.addEventListener("contextmenu",this.contextmenu.bind(this)),this.container.addEventListener("keydown",this.key.bind(this)),this.container.addEventListener("wheel",this.zoom_enter.bind(this)),this.container.addEventListener("input",this.updateNodeValue.bind(this)),this.container.addEventListener("dblclick",this.dblclick.bind(this)),this.container.onpointerdown=this.pointerdown_handler.bind(this),this.container.onpointermove=this.pointermove_handler.bind(this),this.container.onpointerup=this.pointerup_handler.bind(this),this.container.onpointercancel=this.pointerup_handler.bind(this),this.container.onpointerout=this.pointerup_handler.bind(this),this.container.onpointerleave=this.pointerup_handler.bind(this),this.load()}pointerdown_handler(e){this.evCache.push(e)}pointermove_handler(e){for(var t=0;t<this.evCache.length;t++)if(e.pointerId==this.evCache[t].pointerId){this.evCache[t]=e;break}if(this.evCache.length==2){var s=Math.abs(this.evCache[0].clientX-this.evCache[1].clientX);this.prevDiff>100&&(s>this.prevDiff&&this.zoom_in(),s<this.prevDiff&&this.zoom_out()),this.prevDiff=s}}pointerup_handler(e){this.remove_event(e),this.evCache.length<2&&(this.prevDiff=-1)}remove_event(e){for(var t=0;t<this.evCache.length;t++)if(this.evCache[t].pointerId==e.pointerId){this.evCache.splice(t,1);break}}load(){for(var e in this.drawflow.drawflow[this.module].data)this.addNodeImport(this.drawflow.drawflow[this.module].data[e],this.precanvas);if(this.reroute)for(var e in this.drawflow.drawflow[this.module].data)this.addRerouteImport(this.drawflow.drawflow[this.module].data[e]);for(var e in this.drawflow.drawflow[this.module].data)this.updateConnectionNodes("node-"+e);let t=this.drawflow.drawflow,s=1;Object.keys(t).map(function(i,n){Object.keys(t[i].data).map(function(d,r){parseInt(d)>=s&&(s=parseInt(d)+1)})}),this.nodeId=s}removeReouteConnectionSelected(){this.dispatch("connectionUnselected",!0),this.reroute_fix_curvature&&this.connection_selected.parentElement.querySelectorAll(".main-path").forEach((e,t)=>{e.classList.remove("selected")})}click(e){if(this.dispatch("click",e),this.editor_mode==="fixed"){if(e.target.classList[0]!=="parent-drawflow"&&e.target.classList[0]!=="drawflow")return!1;this.ele_selected=e.target.closest(".parent-drawflow"),e.preventDefault()}else this.editor_mode==="view"?(e.target.closest(".drawflow")!=null||e.target.matches(".parent-drawflow"))&&(this.ele_selected=e.target.closest(".parent-drawflow"),e.preventDefault()):(this.first_click=e.target,this.ele_selected=e.target,e.button===0&&this.contextmenuDel(),e.target.closest(".drawflow_content_node")!=null&&(this.ele_selected=e.target.closest(".drawflow_content_node").parentElement));switch(this.ele_selected.classList[0]){case"drawflow-node":this.node_selected!=null&&(this.node_selected.classList.remove("selected"),this.node_selected!=this.ele_selected&&this.dispatch("nodeUnselected",!0)),this.connection_selected!=null&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.node_selected!=this.ele_selected&&this.dispatch("nodeSelected",this.ele_selected.id.slice(5)),this.node_selected=this.ele_selected,this.node_selected.classList.add("selected"),this.draggable_inputs?e.target.tagName!=="SELECT"&&(this.drag=!0):e.target.tagName!=="INPUT"&&e.target.tagName!=="TEXTAREA"&&e.target.tagName!=="SELECT"&&e.target.hasAttribute("contenteditable")!==!0&&(this.drag=!0);break;case"output":this.connection=!0,this.node_selected!=null&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),this.connection_selected!=null&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.drawConnection(e.target);break;case"parent-drawflow":case"drawflow":this.node_selected!=null&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),this.connection_selected!=null&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.editor_selected=!0;break;case"main-path":this.node_selected!=null&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),this.connection_selected!=null&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.connection_selected=this.ele_selected,this.connection_selected.classList.add("selected");let t=this.connection_selected.parentElement.classList;t.length>1&&(this.dispatch("connectionSelected",{output_id:t[2].slice(14),input_id:t[1].slice(13),output_class:t[3],input_class:t[4]}),this.reroute_fix_curvature&&this.connection_selected.parentElement.querySelectorAll(".main-path").forEach((s,i)=>{s.classList.add("selected")}));break;case"point":this.drag_point=!0,this.ele_selected.classList.add("selected");break;case"drawflow-delete":this.node_selected&&this.removeNodeId(this.node_selected.id),this.connection_selected&&this.removeConnection(),this.node_selected!=null&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),this.connection_selected!=null&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null)}e.type==="touchstart"?(this.pos_x=e.touches[0].clientX,this.pos_x_start=e.touches[0].clientX,this.pos_y=e.touches[0].clientY,this.pos_y_start=e.touches[0].clientY,this.mouse_x=e.touches[0].clientX,this.mouse_y=e.touches[0].clientY):(this.pos_x=e.clientX,this.pos_x_start=e.clientX,this.pos_y=e.clientY,this.pos_y_start=e.clientY),["input","output","main-path"].includes(this.ele_selected.classList[0])&&e.preventDefault(),this.dispatch("clickEnd",e)}position(e){if(e.type==="touchmove")var t=e.touches[0].clientX,s=e.touches[0].clientY;else t=e.clientX,s=e.clientY;if(this.connection&&this.updateConnection(t,s),this.editor_selected&&(i=this.canvas_x+-(this.pos_x-t),n=this.canvas_y+-(this.pos_y-s),this.dispatch("translate",{x:i,y:n}),this.precanvas.style.transform="translate("+i+"px, "+n+"px) scale("+this.zoom+")"),this.drag){e.preventDefault();var i=(this.pos_x-t)*this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom),n=(this.pos_y-s)*this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom);this.pos_x=t,this.pos_y=s,this.ele_selected.style.top=this.ele_selected.offsetTop-n+"px",this.ele_selected.style.left=this.ele_selected.offsetLeft-i+"px",this.drawflow.drawflow[this.module].data[this.ele_selected.id.slice(5)].pos_x=this.ele_selected.offsetLeft-i,this.drawflow.drawflow[this.module].data[this.ele_selected.id.slice(5)].pos_y=this.ele_selected.offsetTop-n,this.updateConnectionNodes(this.ele_selected.id)}if(this.drag_point){i=(this.pos_x-t)*this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom),n=(this.pos_y-s)*this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom),this.pos_x=t,this.pos_y=s;var d=this.pos_x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom)),r=this.pos_y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom));this.ele_selected.setAttributeNS(null,"cx",d),this.ele_selected.setAttributeNS(null,"cy",r);let u=this.ele_selected.parentElement.classList[2].slice(9),a=this.ele_selected.parentElement.classList[1].slice(13),o=this.ele_selected.parentElement.classList[3],l=this.ele_selected.parentElement.classList[4],c=Array.from(this.ele_selected.parentElement.children).indexOf(this.ele_selected)-1;this.reroute_fix_curvature&&(c-=this.ele_selected.parentElement.querySelectorAll(".main-path").length-1,c<0&&(c=0));let h=u.slice(5),p=this.drawflow.drawflow[this.module].data[h].outputs[o].connections.findIndex(function(_,C){return _.node===a&&_.output===l});this.drawflow.drawflow[this.module].data[h].outputs[o].connections[p].points[c]={pos_x:d,pos_y:r};let v=this.ele_selected.parentElement.classList[2].slice(9);this.updateConnectionNodes(v)}e.type==="touchmove"&&(this.mouse_x=t,this.mouse_y=s),this.dispatch("mouseMove",{x:t,y:s})}dragEnd(e){if(e.type==="touchend")var t=this.mouse_x,s=this.mouse_y,i=document.elementFromPoint(t,s);else t=e.clientX,s=e.clientY,i=e.target;if(this.drag&&(this.pos_x_start==t&&this.pos_y_start==s||this.dispatch("nodeMoved",this.ele_selected.id.slice(5))),this.drag_point&&(this.ele_selected.classList.remove("selected"),this.pos_x_start==t&&this.pos_y_start==s||this.dispatch("rerouteMoved",this.ele_selected.parentElement.classList[2].slice(14))),this.editor_selected&&(this.canvas_x=this.canvas_x+-(this.pos_x-t),this.canvas_y=this.canvas_y+-(this.pos_y-s),this.editor_selected=!1),this.connection===!0)if(i.classList[0]==="input"||this.force_first_input&&(i.closest(".drawflow_content_node")!=null||i.classList[0]==="drawflow-node")){if(!this.force_first_input||i.closest(".drawflow_content_node")==null&&i.classList[0]!=="drawflow-node")n=i.parentElement.parentElement.id,d=i.classList[1];else{if(i.closest(".drawflow_content_node")!=null)var n=i.closest(".drawflow_content_node").parentElement.id;else var n=i.id;if(Object.keys(this.getNodeFromId(n.slice(5)).inputs).length===0)var d=!1;else var d="input_1"}var r=this.ele_selected.parentElement.parentElement.id,u=this.ele_selected.classList[1];if(r!==n&&d!==!1){if(this.container.querySelectorAll(".connection.node_in_"+n+".node_out_"+r+"."+u+"."+d).length===0){this.connection_ele.classList.add("node_in_"+n),this.connection_ele.classList.add("node_out_"+r),this.connection_ele.classList.add(u),this.connection_ele.classList.add(d);var a=n.slice(5),o=r.slice(5);this.drawflow.drawflow[this.module].data[o].outputs[u].connections.push({node:a,output:d}),this.drawflow.drawflow[this.module].data[a].inputs[d].connections.push({node:o,input:u}),this.updateConnectionNodes("node-"+o),this.updateConnectionNodes("node-"+a),this.dispatch("connectionCreated",{output_id:o,input_id:a,output_class:u,input_class:d})}else this.dispatch("connectionCancel",!0),this.connection_ele.remove();this.connection_ele=null}else this.dispatch("connectionCancel",!0),this.connection_ele.remove(),this.connection_ele=null}else this.dispatch("connectionCancel",!0),this.connection_ele.remove(),this.connection_ele=null;this.drag=!1,this.drag_point=!1,this.connection=!1,this.ele_selected=null,this.editor_selected=!1,this.dispatch("mouseUp",e)}contextmenu(e){if(this.dispatch("contextmenu",e),e.preventDefault(),this.editor_mode==="fixed"||this.editor_mode==="view")return!1;if(this.precanvas.getElementsByClassName("drawflow-delete").length&&this.precanvas.getElementsByClassName("drawflow-delete")[0].remove(),this.node_selected||this.connection_selected){var t=document.createElement("div");t.classList.add("drawflow-delete"),t.innerHTML="x",this.node_selected&&this.node_selected.appendChild(t),this.connection_selected&&this.connection_selected.parentElement.classList.length>1&&(t.style.top=e.clientY*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))+"px",t.style.left=e.clientX*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))+"px",this.precanvas.appendChild(t))}}contextmenuDel(){this.precanvas.getElementsByClassName("drawflow-delete").length&&this.precanvas.getElementsByClassName("drawflow-delete")[0].remove()}key(e){if(this.dispatch("keydown",e),this.editor_mode==="fixed"||this.editor_mode==="view")return!1;(e.key==="Delete"||e.key==="Backspace"&&e.metaKey)&&(this.node_selected!=null&&this.first_click.tagName!=="INPUT"&&this.first_click.tagName!=="TEXTAREA"&&this.first_click.hasAttribute("contenteditable")!==!0&&this.removeNodeId(this.node_selected.id),this.connection_selected!=null&&this.removeConnection())}zoom_enter(e,t){e.ctrlKey&&(e.preventDefault(),e.deltaY>0?this.zoom_out():this.zoom_in())}zoom_refresh(){this.dispatch("zoom",this.zoom),this.canvas_x=this.canvas_x/this.zoom_last_value*this.zoom,this.canvas_y=this.canvas_y/this.zoom_last_value*this.zoom,this.zoom_last_value=this.zoom,this.precanvas.style.transform="translate("+this.canvas_x+"px, "+this.canvas_y+"px) scale("+this.zoom+")"}zoom_in(){this.zoom<this.zoom_max&&(this.zoom+=this.zoom_value,this.zoom_refresh())}zoom_out(){this.zoom>this.zoom_min&&(this.zoom-=this.zoom_value,this.zoom_refresh())}zoom_reset(){this.zoom!=1&&(this.zoom=1,this.zoom_refresh())}createCurvature(e,t,s,i,n,d){var r=e,u=t,a=s,o=i,l=n;switch(d){case"open":if(e>=s)var c=r+Math.abs(a-r)*l,h=a-Math.abs(a-r)*(-1*l);else c=r+Math.abs(a-r)*l,h=a-Math.abs(a-r)*l;return" M "+r+" "+u+" C "+c+" "+u+" "+h+" "+o+" "+a+"  "+o;case"close":return e>=s?(c=r+Math.abs(a-r)*(-1*l),h=a-Math.abs(a-r)*l):(c=r+Math.abs(a-r)*l,h=a-Math.abs(a-r)*l)," M "+r+" "+u+" C "+c+" "+u+" "+h+" "+o+" "+a+"  "+o;case"other":return e>=s?(c=r+Math.abs(a-r)*(-1*l),h=a-Math.abs(a-r)*(-1*l)):(c=r+Math.abs(a-r)*l,h=a-Math.abs(a-r)*l)," M "+r+" "+u+" C "+c+" "+u+" "+h+" "+o+" "+a+"  "+o;default:return" M "+r+" "+u+" C "+(c=r+Math.abs(a-r)*l)+" "+u+" "+(h=a-Math.abs(a-r)*l)+" "+o+" "+a+"  "+o}}drawConnection(e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");this.connection_ele=t;var s=document.createElementNS("http://www.w3.org/2000/svg","path");s.classList.add("main-path"),s.setAttributeNS(null,"d",""),t.classList.add("connection"),t.appendChild(s),this.precanvas.appendChild(t);var i=e.parentElement.parentElement.id.slice(5),n=e.classList[1];this.dispatch("connectionStart",{output_id:i,output_class:n})}updateConnection(e,t){let s=this.precanvas,i=this.zoom,n=s.clientWidth/(s.clientWidth*i);n=n||0;let d=s.clientHeight/(s.clientHeight*i);d=d||0;var r=this.connection_ele.children[0],u=this.ele_selected.offsetWidth/2+(this.ele_selected.getBoundingClientRect().x-s.getBoundingClientRect().x)*n,a=this.ele_selected.offsetHeight/2+(this.ele_selected.getBoundingClientRect().y-s.getBoundingClientRect().y)*d,o=e*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom)),l=t*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom)),c=this.curvature,h=this.createCurvature(u,a,o,l,c,"openclose");r.setAttributeNS(null,"d",h)}addConnection(e,t,s,i){var n=this.getModuleFromNodeId(e);if(n===this.getModuleFromNodeId(t)){var d=this.getNodeFromId(e),r=!1;for(var u in d.outputs[s].connections){var a=d.outputs[s].connections[u];a.node==t&&a.output==i&&(r=!0)}if(r===!1){if(this.drawflow.drawflow[n].data[e].outputs[s].connections.push({node:t.toString(),output:i}),this.drawflow.drawflow[n].data[t].inputs[i].connections.push({node:e.toString(),input:s}),this.module===n){var o=document.createElementNS("http://www.w3.org/2000/svg","svg"),l=document.createElementNS("http://www.w3.org/2000/svg","path");l.classList.add("main-path"),l.setAttributeNS(null,"d",""),o.classList.add("connection"),o.classList.add("node_in_node-"+t),o.classList.add("node_out_node-"+e),o.classList.add(s),o.classList.add(i),o.appendChild(l),this.precanvas.appendChild(o),this.updateConnectionNodes("node-"+e),this.updateConnectionNodes("node-"+t)}this.dispatch("connectionCreated",{output_id:e,input_id:t,output_class:s,input_class:i})}}}updateConnectionNodes(e){let t="node_in_"+e,s="node_out_"+e;this.line_path;let i=this.container,n=this.precanvas,d=this.curvature,r=this.createCurvature,u=this.reroute_curvature,a=this.reroute_curvature_start_end,o=this.reroute_fix_curvature,l=this.reroute_width,c=this.zoom,h=n.clientWidth/(n.clientWidth*c);h=h||0;let p=n.clientHeight/(n.clientHeight*c);p=p||0;let v=i.querySelectorAll("."+s);Object.keys(v).map(function(C,D){if(v[C].querySelector(".point")===null){var q=i.querySelector("#"+e),b=v[C].classList[1].replace("node_in_",""),X=i.querySelector("#"+b).querySelectorAll("."+v[C].classList[4])[0],$=X.offsetWidth/2+(X.getBoundingClientRect().x-n.getBoundingClientRect().x)*h,G=X.offsetHeight/2+(X.getBoundingClientRect().y-n.getBoundingClientRect().y)*p,K=q.querySelectorAll("."+v[C].classList[3])[0],J=K.offsetWidth/2+(K.getBoundingClientRect().x-n.getBoundingClientRect().x)*h,U=K.offsetHeight/2+(K.getBoundingClientRect().y-n.getBoundingClientRect().y)*p;let I=r(J,U,$,G,d,"openclose");v[C].children[0].setAttributeNS(null,"d",I)}else{let I=v[C].querySelectorAll(".point"),z="",S=[];I.forEach((x,y)=>{if(y===0&&I.length-1==0){var R=i.querySelector("#"+e),N=((M=x).getBoundingClientRect().x-n.getBoundingClientRect().x)*h+l,B=(M.getBoundingClientRect().y-n.getBoundingClientRect().y)*p+l,k=(H=R.querySelectorAll("."+x.parentElement.classList[3])[0]).offsetWidth/2+(H.getBoundingClientRect().x-n.getBoundingClientRect().x)*h,E=H.offsetHeight/2+(H.getBoundingClientRect().y-n.getBoundingClientRect().y)*p,A=r(k,E,N,B,a,"open");z+=A,S.push(A),R=x;var Y=x.parentElement.classList[1].replace("node_in_",""),M=(V=i.querySelector("#"+Y)).querySelectorAll("."+x.parentElement.classList[4])[0];N=(Z=V.querySelectorAll("."+x.parentElement.classList[4])[0]).offsetWidth/2+(Z.getBoundingClientRect().x-n.getBoundingClientRect().x)*h,B=Z.offsetHeight/2+(Z.getBoundingClientRect().y-n.getBoundingClientRect().y)*p,k=(R.getBoundingClientRect().x-n.getBoundingClientRect().x)*h+l,E=(R.getBoundingClientRect().y-n.getBoundingClientRect().y)*p+l,A=r(k,E,N,B,a,"close"),z+=A,S.push(A)}else if(y===0){var H;R=i.querySelector("#"+e),N=((M=x).getBoundingClientRect().x-n.getBoundingClientRect().x)*h+l,B=(M.getBoundingClientRect().y-n.getBoundingClientRect().y)*p+l,k=(H=R.querySelectorAll("."+x.parentElement.classList[3])[0]).offsetWidth/2+(H.getBoundingClientRect().x-n.getBoundingClientRect().x)*h,E=H.offsetHeight/2+(H.getBoundingClientRect().y-n.getBoundingClientRect().y)*p,A=r(k,E,N,B,a,"open"),z+=A,S.push(A),R=x,N=((M=I[y+1]).getBoundingClientRect().x-n.getBoundingClientRect().x)*h+l,B=(M.getBoundingClientRect().y-n.getBoundingClientRect().y)*p+l,k=(R.getBoundingClientRect().x-n.getBoundingClientRect().x)*h+l,E=(R.getBoundingClientRect().y-n.getBoundingClientRect().y)*p+l,A=r(k,E,N,B,u,"other"),z+=A,S.push(A)}else if(y===I.length-1){var V,Z;R=x,Y=x.parentElement.classList[1].replace("node_in_",""),M=(V=i.querySelector("#"+Y)).querySelectorAll("."+x.parentElement.classList[4])[0],N=(Z=V.querySelectorAll("."+x.parentElement.classList[4])[0]).offsetWidth/2+(Z.getBoundingClientRect().x-n.getBoundingClientRect().x)*h,B=Z.offsetHeight/2+(Z.getBoundingClientRect().y-n.getBoundingClientRect().y)*p,k=(R.getBoundingClientRect().x-n.getBoundingClientRect().x)*(n.clientWidth/(n.clientWidth*c))+l,E=(R.getBoundingClientRect().y-n.getBoundingClientRect().y)*(n.clientHeight/(n.clientHeight*c))+l,A=r(k,E,N,B,a,"close"),z+=A,S.push(A)}else R=x,N=((M=I[y+1]).getBoundingClientRect().x-n.getBoundingClientRect().x)*(n.clientWidth/(n.clientWidth*c))+l,B=(M.getBoundingClientRect().y-n.getBoundingClientRect().y)*(n.clientHeight/(n.clientHeight*c))+l,k=(R.getBoundingClientRect().x-n.getBoundingClientRect().x)*(n.clientWidth/(n.clientWidth*c))+l,E=(R.getBoundingClientRect().y-n.getBoundingClientRect().y)*(n.clientHeight/(n.clientHeight*c))+l,A=r(k,E,N,B,u,"other"),z+=A,S.push(A)}),o?S.forEach((x,y)=>{v[C].children[y].setAttributeNS(null,"d",x)}):v[C].children[0].setAttributeNS(null,"d",z)}});let _=i.querySelectorAll("."+t);Object.keys(_).map(function(C,D){if(_[C].querySelector(".point")===null){var q=i.querySelector("#"+e),b=_[C].classList[2].replace("node_out_",""),X=i.querySelector("#"+b).querySelectorAll("."+_[C].classList[3])[0],$=X.offsetWidth/2+(X.getBoundingClientRect().x-n.getBoundingClientRect().x)*h,G=X.offsetHeight/2+(X.getBoundingClientRect().y-n.getBoundingClientRect().y)*p,K=(q=q.querySelectorAll("."+_[C].classList[4])[0]).offsetWidth/2+(q.getBoundingClientRect().x-n.getBoundingClientRect().x)*h,J=q.offsetHeight/2+(q.getBoundingClientRect().y-n.getBoundingClientRect().y)*p;let U=r($,G,K,J,d,"openclose");_[C].children[0].setAttributeNS(null,"d",U)}else{let U=_[C].querySelectorAll(".point"),I="",z=[];U.forEach((S,x)=>{if(x===0&&U.length-1==0){var y=i.querySelector("#"+e),R=((Y=S).getBoundingClientRect().x-n.getBoundingClientRect().x)*h+l,N=(Y.getBoundingClientRect().y-n.getBoundingClientRect().y)*p+l,B=(V=y.querySelectorAll("."+S.parentElement.classList[4])[0]).offsetWidth/2+(V.getBoundingClientRect().x-n.getBoundingClientRect().x)*h,k=V.offsetHeight/2+(V.getBoundingClientRect().y-n.getBoundingClientRect().y)*p,E=r(R,N,B,k,a,"close");I+=E,z.push(E),y=S;var A=S.parentElement.classList[2].replace("node_out_",""),Y=(H=i.querySelector("#"+A)).querySelectorAll("."+S.parentElement.classList[3])[0];R=(M=H.querySelectorAll("."+S.parentElement.classList[3])[0]).offsetWidth/2+(M.getBoundingClientRect().x-n.getBoundingClientRect().x)*h,N=M.offsetHeight/2+(M.getBoundingClientRect().y-n.getBoundingClientRect().y)*p,B=(y.getBoundingClientRect().x-n.getBoundingClientRect().x)*h+l,k=(y.getBoundingClientRect().y-n.getBoundingClientRect().y)*p+l,E=r(R,N,B,k,a,"open"),I+=E,z.push(E)}else if(x===0){var M;y=S,A=S.parentElement.classList[2].replace("node_out_",""),Y=(H=i.querySelector("#"+A)).querySelectorAll("."+S.parentElement.classList[3])[0],R=(M=H.querySelectorAll("."+S.parentElement.classList[3])[0]).offsetWidth/2+(M.getBoundingClientRect().x-n.getBoundingClientRect().x)*h,N=M.offsetHeight/2+(M.getBoundingClientRect().y-n.getBoundingClientRect().y)*p,B=(y.getBoundingClientRect().x-n.getBoundingClientRect().x)*h+l,k=(y.getBoundingClientRect().y-n.getBoundingClientRect().y)*p+l,E=r(R,N,B,k,a,"open"),I+=E,z.push(E),y=S,B=((Y=U[x+1]).getBoundingClientRect().x-n.getBoundingClientRect().x)*h+l,k=(Y.getBoundingClientRect().y-n.getBoundingClientRect().y)*p+l,R=(y.getBoundingClientRect().x-n.getBoundingClientRect().x)*h+l,N=(y.getBoundingClientRect().y-n.getBoundingClientRect().y)*p+l,E=r(R,N,B,k,u,"other"),I+=E,z.push(E)}else if(x===U.length-1){var H,V;y=S,A=S.parentElement.classList[1].replace("node_in_",""),Y=(H=i.querySelector("#"+A)).querySelectorAll("."+S.parentElement.classList[4])[0],B=(V=H.querySelectorAll("."+S.parentElement.classList[4])[0]).offsetWidth/2+(V.getBoundingClientRect().x-n.getBoundingClientRect().x)*h,k=V.offsetHeight/2+(V.getBoundingClientRect().y-n.getBoundingClientRect().y)*p,R=(y.getBoundingClientRect().x-n.getBoundingClientRect().x)*h+l,N=(y.getBoundingClientRect().y-n.getBoundingClientRect().y)*p+l,E=r(R,N,B,k,a,"close"),I+=E,z.push(E)}else y=S,B=((Y=U[x+1]).getBoundingClientRect().x-n.getBoundingClientRect().x)*h+l,k=(Y.getBoundingClientRect().y-n.getBoundingClientRect().y)*p+l,R=(y.getBoundingClientRect().x-n.getBoundingClientRect().x)*h+l,N=(y.getBoundingClientRect().y-n.getBoundingClientRect().y)*p+l,E=r(R,N,B,k,u,"other"),I+=E,z.push(E)}),o?z.forEach((S,x)=>{_[C].children[x].setAttributeNS(null,"d",S)}):_[C].children[0].setAttributeNS(null,"d",I)}})}dblclick(e){this.connection_selected!=null&&this.reroute&&this.createReroutePoint(this.connection_selected),e.target.classList[0]==="point"&&this.removeReroutePoint(e.target)}createReroutePoint(e){this.connection_selected.classList.remove("selected");let t=this.connection_selected.parentElement.classList[2].slice(9),s=this.connection_selected.parentElement.classList[1].slice(13),i=this.connection_selected.parentElement.classList[3],n=this.connection_selected.parentElement.classList[4];this.connection_selected=null;let d=document.createElementNS("http://www.w3.org/2000/svg","circle");d.classList.add("point");var r=this.pos_x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom)),u=this.pos_y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom));d.setAttributeNS(null,"cx",r),d.setAttributeNS(null,"cy",u),d.setAttributeNS(null,"r",this.reroute_width);let a=0;if(this.reroute_fix_curvature){let h=e.parentElement.querySelectorAll(".main-path").length;var o=document.createElementNS("http://www.w3.org/2000/svg","path");if(o.classList.add("main-path"),o.setAttributeNS(null,"d",""),e.parentElement.insertBefore(o,e.parentElement.children[h]),h===1)e.parentElement.appendChild(d);else{let p=Array.from(e.parentElement.children).indexOf(e);a=p,e.parentElement.insertBefore(d,e.parentElement.children[p+h+1])}}else e.parentElement.appendChild(d);let l=t.slice(5),c=this.drawflow.drawflow[this.module].data[l].outputs[i].connections.findIndex(function(h,p){return h.node===s&&h.output===n});this.drawflow.drawflow[this.module].data[l].outputs[i].connections[c].points===void 0&&(this.drawflow.drawflow[this.module].data[l].outputs[i].connections[c].points=[]),this.reroute_fix_curvature?(a>0||this.drawflow.drawflow[this.module].data[l].outputs[i].connections[c].points!==[]?this.drawflow.drawflow[this.module].data[l].outputs[i].connections[c].points.splice(a,0,{pos_x:r,pos_y:u}):this.drawflow.drawflow[this.module].data[l].outputs[i].connections[c].points.push({pos_x:r,pos_y:u}),e.parentElement.querySelectorAll(".main-path").forEach((h,p)=>{h.classList.remove("selected")})):this.drawflow.drawflow[this.module].data[l].outputs[i].connections[c].points.push({pos_x:r,pos_y:u}),this.dispatch("addReroute",l),this.updateConnectionNodes(t)}removeReroutePoint(e){let t=e.parentElement.classList[2].slice(9),s=e.parentElement.classList[1].slice(13),i=e.parentElement.classList[3],n=e.parentElement.classList[4],d=Array.from(e.parentElement.children).indexOf(e),r=t.slice(5),u=this.drawflow.drawflow[this.module].data[r].outputs[i].connections.findIndex(function(a,o){return a.node===s&&a.output===n});if(this.reroute_fix_curvature){let a=e.parentElement.querySelectorAll(".main-path").length;e.parentElement.children[a-1].remove(),d-=a,d<0&&(d=0)}else d--;this.drawflow.drawflow[this.module].data[r].outputs[i].connections[u].points.splice(d,1),e.remove(),this.dispatch("removeReroute",r),this.updateConnectionNodes(t)}registerNode(e,t,s=null,i=null){this.noderegister[e]={html:t,props:s,options:i}}getNodeFromId(e){var t=this.getModuleFromNodeId(e);return JSON.parse(JSON.stringify(this.drawflow.drawflow[t].data[e]))}getNodesFromName(e){var t=[];let s=this.drawflow.drawflow;return Object.keys(s).map(function(i,n){for(var d in s[i].data)s[i].data[d].name==e&&t.push(s[i].data[d].id)}),t}addNode(e,t,s,i,n,d,r,u,a=!1){if(this.useuuid)var o=this.getUuid();else o=this.nodeId;let l=document.createElement("div");l.classList.add("parent-node");let c=document.createElement("div");c.innerHTML="",c.setAttribute("id","node-"+o),c.classList.add("drawflow-node"),d!=""&&c.classList.add(...d.split(" "));let h=document.createElement("div");h.classList.add("inputs");let p=document.createElement("div");p.classList.add("outputs");let v={};for(var _=0;_<t;_++){let b=document.createElement("div");b.classList.add("input"),b.classList.add("input_"+(_+1)),v["input_"+(_+1)]={connections:[]},h.appendChild(b)}let C={};for(_=0;_<s;_++){let b=document.createElement("div");b.classList.add("output"),b.classList.add("output_"+(_+1)),C["output_"+(_+1)]={connections:[]},p.appendChild(b)}let D=document.createElement("div");if(D.classList.add("drawflow_content_node"),a===!1)D.innerHTML=u;else if(a===!0)D.appendChild(this.noderegister[u].html.cloneNode(!0));else if(parseInt(this.render.version)===3){let b=this.render.h(this.noderegister[u].html,this.noderegister[u].props,this.noderegister[u].options);b.appContext=this.parent,this.render.render(b,D)}else{let b=new this.render(te({parent:this.parent,render:X=>X(this.noderegister[u].html,{props:this.noderegister[u].props})},this.noderegister[u].options)).$mount();D.appendChild(b.$el)}Object.entries(r).forEach(function(b,X){if(typeof b[1]=="object")(function K(J,U,I){J===null?J=r[U]:J=J[U],J!==null&&Object.entries(J).forEach(function(z,S){if(typeof z[1]=="object")K(J,z[0],I+"-"+z[0]);else for(var x=D.querySelectorAll("[df-"+I+"-"+z[0]+"]"),y=0;y<x.length;y++)x[y].value=z[1],x[y].isContentEditable&&(x[y].innerText=z[1])})})(null,b[0],b[0]);else for(var $=D.querySelectorAll("[df-"+b[0]+"]"),G=0;G<$.length;G++)$[G].value=b[1],$[G].isContentEditable&&($[G].innerText=b[1])}),c.appendChild(h),c.appendChild(D),c.appendChild(p),c.style.top=n+"px",c.style.left=i+"px",l.appendChild(c),this.precanvas.appendChild(l);var q={id:o,name:e,data:r,class:d,html:u,typenode:a,inputs:v,outputs:C,pos_x:i,pos_y:n};return this.drawflow.drawflow[this.module].data[o]=q,this.dispatch("nodeCreated",o),this.useuuid||this.nodeId++,o}addNodeImport(e,t){let s=document.createElement("div");s.classList.add("parent-node");let i=document.createElement("div");i.innerHTML="",i.setAttribute("id","node-"+e.id),i.classList.add("drawflow-node"),e.class!=""&&i.classList.add(...e.class.split(" "));let n=document.createElement("div");n.classList.add("inputs");let d=document.createElement("div");d.classList.add("outputs"),Object.keys(e.inputs).map(function(a,o){let l=document.createElement("div");l.classList.add("input"),l.classList.add(a),n.appendChild(l),Object.keys(e.inputs[a].connections).map(function(c,h){var p=document.createElementNS("http://www.w3.org/2000/svg","svg"),v=document.createElementNS("http://www.w3.org/2000/svg","path");v.classList.add("main-path"),v.setAttributeNS(null,"d",""),p.classList.add("connection"),p.classList.add("node_in_node-"+e.id),p.classList.add("node_out_node-"+e.inputs[a].connections[c].node),p.classList.add(e.inputs[a].connections[c].input),p.classList.add(a),p.appendChild(v),t.appendChild(p)})});for(var r=0;r<Object.keys(e.outputs).length;r++){let a=document.createElement("div");a.classList.add("output"),a.classList.add("output_"+(r+1)),d.appendChild(a)}let u=document.createElement("div");if(u.classList.add("drawflow_content_node"),e.typenode===!1)u.innerHTML=e.html;else if(e.typenode===!0)u.appendChild(this.noderegister[e.html].html.cloneNode(!0));else if(parseInt(this.render.version)===3){let a=this.render.h(this.noderegister[e.html].html,this.noderegister[e.html].props,this.noderegister[e.html].options);a.appContext=this.parent,this.render.render(a,u)}else{let a=new this.render(te({parent:this.parent,render:o=>o(this.noderegister[e.html].html,{props:this.noderegister[e.html].props})},this.noderegister[e.html].options)).$mount();u.appendChild(a.$el)}Object.entries(e.data).forEach(function(a,o){if(typeof a[1]=="object")(function h(p,v,_){p===null?p=e.data[v]:p=p[v],p!==null&&Object.entries(p).forEach(function(C,D){if(typeof C[1]=="object")h(p,C[0],_+"-"+C[0]);else for(var q=u.querySelectorAll("[df-"+_+"-"+C[0]+"]"),b=0;b<q.length;b++)q[b].value=C[1],q[b].isContentEditable&&(q[b].innerText=C[1])})})(null,a[0],a[0]);else for(var l=u.querySelectorAll("[df-"+a[0]+"]"),c=0;c<l.length;c++)l[c].value=a[1],l[c].isContentEditable&&(l[c].innerText=a[1])}),i.appendChild(n),i.appendChild(u),i.appendChild(d),i.style.top=e.pos_y+"px",i.style.left=e.pos_x+"px",s.appendChild(i),this.precanvas.appendChild(s)}addRerouteImport(e){let t=this.reroute_width,s=this.reroute_fix_curvature,i=this.container;Object.keys(e.outputs).map(function(n,d){Object.keys(e.outputs[n].connections).map(function(r,u){let a=e.outputs[n].connections[r].points;a!==void 0&&a.forEach((o,l)=>{let c=e.outputs[n].connections[r].node,h=e.outputs[n].connections[r].output,p=i.querySelector(".connection.node_in_node-"+c+".node_out_node-"+e.id+"."+n+"."+h);if(s&&l===0)for(var v=0;v<a.length;v++){var _=document.createElementNS("http://www.w3.org/2000/svg","path");_.classList.add("main-path"),_.setAttributeNS(null,"d",""),p.appendChild(_)}let C=document.createElementNS("http://www.w3.org/2000/svg","circle");C.classList.add("point");var D=o.pos_x,q=o.pos_y;C.setAttributeNS(null,"cx",D),C.setAttributeNS(null,"cy",q),C.setAttributeNS(null,"r",t),p.appendChild(C)})})})}updateNodeValue(e){for(var t=e.target.attributes,s=0;s<t.length;s++)if(t[s].nodeName.startsWith("df-")){for(var i=t[s].nodeName.slice(3).split("-"),n=this.drawflow.drawflow[this.module].data[e.target.closest(".drawflow_content_node").parentElement.id.slice(5)].data,d=0;d<i.length-1;d+=1)n[i[d]]==null&&(n[i[d]]={}),n=n[i[d]];n[i[i.length-1]]=e.target.value,e.target.isContentEditable&&(n[i[i.length-1]]=e.target.innerText),this.dispatch("nodeDataChanged",e.target.closest(".drawflow_content_node").parentElement.id.slice(5))}}updateNodeDataFromId(e,t){var s=this.getModuleFromNodeId(e);if(this.drawflow.drawflow[s].data[e].data=t,this.module===s){let i=this.container.querySelector("#node-"+e);Object.entries(t).forEach(function(n,d){if(typeof n[1]=="object")(function a(o,l,c){o===null?o=t[l]:o=o[l],o!==null&&Object.entries(o).forEach(function(h,p){if(typeof h[1]=="object")a(o,h[0],c+"-"+h[0]);else for(var v=i.querySelectorAll("[df-"+c+"-"+h[0]+"]"),_=0;_<v.length;_++)v[_].value=h[1],v[_].isContentEditable&&(v[_].innerText=h[1])})})(null,n[0],n[0]);else for(var r=i.querySelectorAll("[df-"+n[0]+"]"),u=0;u<r.length;u++)r[u].value=n[1],r[u].isContentEditable&&(r[u].innerText=n[1])})}}addNodeInput(e){var t=this.getModuleFromNodeId(e);let s=this.getNodeFromId(e),i=Object.keys(s.inputs).length;if(this.module===t){let n=document.createElement("div");n.classList.add("input"),n.classList.add("input_"+(i+1)),this.container.querySelector("#node-"+e+" .inputs").appendChild(n),this.updateConnectionNodes("node-"+e)}this.drawflow.drawflow[t].data[e].inputs["input_"+(i+1)]={connections:[]}}addNodeOutput(e){var t=this.getModuleFromNodeId(e);let s=this.getNodeFromId(e),i=Object.keys(s.outputs).length;if(this.module===t){let n=document.createElement("div");n.classList.add("output"),n.classList.add("output_"+(i+1)),this.container.querySelector("#node-"+e+" .outputs").appendChild(n),this.updateConnectionNodes("node-"+e)}this.drawflow.drawflow[t].data[e].outputs["output_"+(i+1)]={connections:[]}}removeNodeInput(e,t){var s=this.getModuleFromNodeId(e);let i=this.getNodeFromId(e);this.module===s&&this.container.querySelector("#node-"+e+" .inputs .input."+t).remove();let n=[];Object.keys(i.inputs[t].connections).map(function(o,l){let c=i.inputs[t].connections[l].node,h=i.inputs[t].connections[l].input;n.push({id_output:c,id:e,output_class:h,input_class:t})}),n.forEach((o,l)=>{this.removeSingleConnection(o.id_output,o.id,o.output_class,o.input_class)}),delete this.drawflow.drawflow[s].data[e].inputs[t];let d=[],r=this.drawflow.drawflow[s].data[e].inputs;Object.keys(r).map(function(o,l){d.push(r[o])}),this.drawflow.drawflow[s].data[e].inputs={};let u=t.slice(6),a=[];d.forEach((o,l)=>{o.connections.forEach((c,h)=>{a.push(c)}),this.drawflow.drawflow[s].data[e].inputs["input_"+(l+1)]=o}),a=new Set(a.map(o=>JSON.stringify(o))),a=Array.from(a).map(o=>JSON.parse(o)),this.module===s&&this.container.querySelectorAll("#node-"+e+" .inputs .input").forEach((o,l)=>{let c=o.classList[1].slice(6);parseInt(u)<parseInt(c)&&(o.classList.remove("input_"+c),o.classList.add("input_"+(c-1)))}),a.forEach((o,l)=>{this.drawflow.drawflow[s].data[o.node].outputs[o.input].connections.forEach((c,h)=>{if(c.node==e){let p=c.output.slice(6);if(parseInt(u)<parseInt(p)){if(this.module===s){let v=this.container.querySelector(".connection.node_in_node-"+e+".node_out_node-"+o.node+"."+o.input+".input_"+p);v.classList.remove("input_"+p),v.classList.add("input_"+(p-1))}c.points?this.drawflow.drawflow[s].data[o.node].outputs[o.input].connections[h]={node:c.node,output:"input_"+(p-1),points:c.points}:this.drawflow.drawflow[s].data[o.node].outputs[o.input].connections[h]={node:c.node,output:"input_"+(p-1)}}}})}),this.updateConnectionNodes("node-"+e)}removeNodeOutput(e,t){var s=this.getModuleFromNodeId(e);let i=this.getNodeFromId(e);this.module===s&&this.container.querySelector("#node-"+e+" .outputs .output."+t).remove();let n=[];Object.keys(i.outputs[t].connections).map(function(o,l){let c=i.outputs[t].connections[l].node,h=i.outputs[t].connections[l].output;n.push({id:e,id_input:c,output_class:t,input_class:h})}),n.forEach((o,l)=>{this.removeSingleConnection(o.id,o.id_input,o.output_class,o.input_class)}),delete this.drawflow.drawflow[s].data[e].outputs[t];let d=[],r=this.drawflow.drawflow[s].data[e].outputs;Object.keys(r).map(function(o,l){d.push(r[o])}),this.drawflow.drawflow[s].data[e].outputs={};let u=t.slice(7),a=[];d.forEach((o,l)=>{o.connections.forEach((c,h)=>{a.push({node:c.node,output:c.output})}),this.drawflow.drawflow[s].data[e].outputs["output_"+(l+1)]=o}),a=new Set(a.map(o=>JSON.stringify(o))),a=Array.from(a).map(o=>JSON.parse(o)),this.module===s&&this.container.querySelectorAll("#node-"+e+" .outputs .output").forEach((o,l)=>{let c=o.classList[1].slice(7);parseInt(u)<parseInt(c)&&(o.classList.remove("output_"+c),o.classList.add("output_"+(c-1)))}),a.forEach((o,l)=>{this.drawflow.drawflow[s].data[o.node].inputs[o.output].connections.forEach((c,h)=>{if(c.node==e){let p=c.input.slice(7);if(parseInt(u)<parseInt(p)){if(this.module===s){let v=this.container.querySelector(".connection.node_in_node-"+o.node+".node_out_node-"+e+".output_"+p+"."+o.output);v.classList.remove("output_"+p),v.classList.remove(o.output),v.classList.add("output_"+(p-1)),v.classList.add(o.output)}c.points?this.drawflow.drawflow[s].data[o.node].inputs[o.output].connections[h]={node:c.node,input:"output_"+(p-1),points:c.points}:this.drawflow.drawflow[s].data[o.node].inputs[o.output].connections[h]={node:c.node,input:"output_"+(p-1)}}}})}),this.updateConnectionNodes("node-"+e)}removeNodeId(e){this.removeConnectionNodeId(e);var t=this.getModuleFromNodeId(e.slice(5));this.module===t&&this.container.querySelector("#"+e).remove(),delete this.drawflow.drawflow[t].data[e.slice(5)],this.dispatch("nodeRemoved",e.slice(5))}removeConnection(){if(this.connection_selected!=null){var e=this.connection_selected.parentElement.classList;this.connection_selected.parentElement.remove();var t=this.drawflow.drawflow[this.module].data[e[2].slice(14)].outputs[e[3]].connections.findIndex(function(i,n){return i.node===e[1].slice(13)&&i.output===e[4]});this.drawflow.drawflow[this.module].data[e[2].slice(14)].outputs[e[3]].connections.splice(t,1);var s=this.drawflow.drawflow[this.module].data[e[1].slice(13)].inputs[e[4]].connections.findIndex(function(i,n){return i.node===e[2].slice(14)&&i.input===e[3]});this.drawflow.drawflow[this.module].data[e[1].slice(13)].inputs[e[4]].connections.splice(s,1),this.dispatch("connectionRemoved",{output_id:e[2].slice(14),input_id:e[1].slice(13),output_class:e[3],input_class:e[4]}),this.connection_selected=null}}removeSingleConnection(e,t,s,i){var n=this.getModuleFromNodeId(e);if(n===this.getModuleFromNodeId(t)){if(this.drawflow.drawflow[n].data[e].outputs[s].connections.findIndex(function(u,a){return u.node==t&&u.output===i})>-1){this.module===n&&this.container.querySelector(".connection.node_in_node-"+t+".node_out_node-"+e+"."+s+"."+i).remove();var d=this.drawflow.drawflow[n].data[e].outputs[s].connections.findIndex(function(u,a){return u.node==t&&u.output===i});this.drawflow.drawflow[n].data[e].outputs[s].connections.splice(d,1);var r=this.drawflow.drawflow[n].data[t].inputs[i].connections.findIndex(function(u,a){return u.node==e&&u.input===s});return this.drawflow.drawflow[n].data[t].inputs[i].connections.splice(r,1),this.dispatch("connectionRemoved",{output_id:e,input_id:t,output_class:s,input_class:i}),!0}return!1}return!1}removeConnectionNodeId(e){let t="node_in_"+e,s="node_out_"+e,i=this.container.querySelectorAll("."+s);for(var n=i.length-1;n>=0;n--){var d=i[n].classList,r=this.drawflow.drawflow[this.module].data[d[1].slice(13)].inputs[d[4]].connections.findIndex(function(o,l){return o.node===d[2].slice(14)&&o.input===d[3]});this.drawflow.drawflow[this.module].data[d[1].slice(13)].inputs[d[4]].connections.splice(r,1);var u=this.drawflow.drawflow[this.module].data[d[2].slice(14)].outputs[d[3]].connections.findIndex(function(o,l){return o.node===d[1].slice(13)&&o.output===d[4]});this.drawflow.drawflow[this.module].data[d[2].slice(14)].outputs[d[3]].connections.splice(u,1),i[n].remove(),this.dispatch("connectionRemoved",{output_id:d[2].slice(14),input_id:d[1].slice(13),output_class:d[3],input_class:d[4]})}let a=this.container.querySelectorAll("."+t);for(n=a.length-1;n>=0;n--)d=a[n].classList,u=this.drawflow.drawflow[this.module].data[d[2].slice(14)].outputs[d[3]].connections.findIndex(function(o,l){return o.node===d[1].slice(13)&&o.output===d[4]}),this.drawflow.drawflow[this.module].data[d[2].slice(14)].outputs[d[3]].connections.splice(u,1),r=this.drawflow.drawflow[this.module].data[d[1].slice(13)].inputs[d[4]].connections.findIndex(function(o,l){return o.node===d[2].slice(14)&&o.input===d[3]}),this.drawflow.drawflow[this.module].data[d[1].slice(13)].inputs[d[4]].connections.splice(r,1),a[n].remove(),this.dispatch("connectionRemoved",{output_id:d[2].slice(14),input_id:d[1].slice(13),output_class:d[3],input_class:d[4]})}getModuleFromNodeId(e){var t;let s=this.drawflow.drawflow;return Object.keys(s).map(function(i,n){Object.keys(s[i].data).map(function(d,r){d==e&&(t=i)})}),t}addModule(e){this.drawflow.drawflow[e]={data:{}},this.dispatch("moduleCreated",e)}changeModule(e){this.dispatch("moduleChanged",e),this.module=e,this.precanvas.innerHTML="",this.canvas_x=0,this.canvas_y=0,this.pos_x=0,this.pos_y=0,this.mouse_x=0,this.mouse_y=0,this.zoom=1,this.zoom_last_value=1,this.precanvas.style.transform="",this.import(this.drawflow,!1)}removeModule(e){this.module===e&&this.changeModule("Home"),delete this.drawflow.drawflow[e],this.dispatch("moduleRemoved",e)}clearModuleSelected(){this.precanvas.innerHTML="",this.drawflow.drawflow[this.module]={data:{}}}clear(){this.precanvas.innerHTML="",this.drawflow={drawflow:{Home:{data:{}}}}}export(){let e=JSON.parse(JSON.stringify(this.drawflow));return this.dispatch("export",e),e}import(e,t=!0){this.clear(),this.drawflow=JSON.parse(JSON.stringify(e)),this.load(),t&&this.dispatch("import","import")}on(e,t){return typeof t!="function"?(console.error("The listener callback must be a function, the given type is "+typeof t),!1):typeof e!="string"?(console.error("The event name must be a string, the given type is "+typeof e),!1):(this.events[e]===void 0&&(this.events[e]={listeners:[]}),void this.events[e].listeners.push(t))}removeListener(e,t){if(!this.events[e])return!1;let s=this.events[e].listeners,i=s.indexOf(t);i>-1&&s.splice(i,1)}dispatch(e,t){if(this.events[e]===void 0)return!1;this.events[e].listeners.forEach(s=>{s(t)})}getUuid(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}}}]).default})});var ce=ue(de());var pe=["container"],re=class Q{drawflow;drawflowContainer;ngAfterViewInit(){this.drawflowContainer&&(this.startDrawflow(),this.handleEditorEvent())}startDrawflow(){this.drawflow=new ce.default(this.drawflowContainer.nativeElement),this.drawflow.editor_mode="edit",this.drawflow.curvature=0,this.drawflow.reroute_curvature_start_end=0,this.drawflow.reroute_curvature=.3,this.drawflow.start()}handleEditorEvent(){this.drawflow?.on("click",m=>{console.log("show me click:",m)}),this.drawflow?.on("nodeCreated",function(m){console.log("Node created "+m)}),this.drawflow?.on("nodeRemoved",function(m){console.log("Node removed "+m)}),this.drawflow?.on("nodeSelected",function(m){console.log("Node selected "+m)}),this.drawflow?.on("moduleCreated",function(m){console.log("Module Created "+m)}),this.drawflow?.on("moduleChanged",function(m){console.log("Module Changed "+m)}),this.drawflow?.on("connectionCreated",function(m){console.log("Connection created"),console.log(m)}),this.drawflow?.on("connectionRemoved",function(m){console.log("Connection removed"),console.log(m)}),this.drawflow?.on("mouseMove",function(m){}),this.drawflow?.on("nodeMoved",function(m){console.log("Node moved "+m)}),this.drawflow?.on("zoom",function(m){console.log("Zoom level "+m)}),this.drawflow?.on("translate",function(m){}),this.drawflow?.on("addReroute",function(m){console.log("Reroute added "+m)}),this.drawflow?.on("removeReroute",function(m){console.log("Reroute removed "+m)})}drag(m){m.dataTransfer.setData("node",m.target.getAttribute("data-node"))}allowDrop(m){m.preventDefault()}drop(m){m.preventDefault();let g=m.dataTransfer.getData("node");this.addNodeToDrawFlow(g,m.clientX,m.clientY)}addNodeToDrawFlow(m,g,f){if(this.drawflow.editor_mode!=="fixed")switch(g=g*(this.drawflow.precanvas.clientWidth/(this.drawflow.precanvas.clientWidth*this.drawflow.zoom))-this.drawflow.precanvas.getBoundingClientRect().x*(this.drawflow.precanvas.clientWidth/(this.drawflow.precanvas.clientWidth*this.drawflow.zoom)),f=f*(this.drawflow.precanvas.clientHeight/(this.drawflow.precanvas.clientHeight*this.drawflow.zoom))-this.drawflow.precanvas.getBoundingClientRect().y*(this.drawflow.precanvas.clientHeight/(this.drawflow.precanvas.clientHeight*this.drawflow.zoom)),m){case"facebook":var w=`
        <div>
          <div class="title-box"><i class="fab fa-facebook"></i> Facebook Message</div>
        </div>
        `;this.drawflow.addNode("facebook",0,1,g,f,"facebook",{},w,!1);break;case"slack":var e=`
          <div>
            <div class="title-box"><i class="fab fa-slack"></i> Slack chat message</div>
          </div>
          `;this.drawflow.addNode("slack",1,0,g,f,"slack",{},e,!1);break;case"github":this.drawflow.addNode("github",0,1,g,f,"github",{name:""},`
          <div>
            <div class="title-box"><i class="fab fa-github "></i> Github Stars</div>
            <div class="box">
              <p>Enter repository url</p>
              <input type="text" df-name>
            </div>
          </div>
          `,!1);break;case"telegram":this.drawflow.addNode("telegram",1,0,g,f,"telegram",{channel:"channel_3"},`
          <div>
            <div class="title-box"><i class="fab fa-telegram-plane"></i> Telegram bot</div>
            <div class="box">
              <p>Send to telegram</p>
              <p>select channel</p>
              <select df-channel>
                <option value="channel_1">Channel 1</option>
                <option value="channel_2">Channel 2</option>
                <option value="channel_3">Channel 3</option>
                <option value="channel_4">Channel 4</option>
              </select>
            </div>
          </div>
          `,!1);break;case"aws":var t=`
          <div>
            <div class="title-box"><i class="fab fa-aws"></i> Aws Save </div>
            <div class="box">
              <p>Save in aws</p>
              <input type="text" df-db-dbname placeholder="DB name"><br><br>
              <input type="text" df-db-key placeholder="DB key">
              <p>Output Log</p>
            </div>
          </div>
          `;this.drawflow.addNode("aws",1,1,g,f,"aws",{db:{dbname:"",key:""}},t,!1);break;case"log":this.drawflow.addNode("log",1,0,g,f,"log",{},`
            <div>
              <div class="title-box"><i class="fas fa-file-signature"></i> Save log file </div>
            </div>
            `,!1);break;case"google":this.drawflow.addNode("google",1,0,g,f,"google",{},`
            <div>
              <div class="title-box"><i class="fab fa-google-drive"></i> Google Drive save </div>
            </div>
            `,!1);break;case"email":this.drawflow.addNode("email",1,0,g,f,"email",{},`
            <div>
              <div class="title-box"><i class="fas fa-at"></i> Send Email </div>
            </div>
            `,!1);break;case"template":this.drawflow.addNode("template",1,1,g,f,"template",{template:"Write your template"},`
            <div>
              <div class="title-box"><i class="fas fa-code"></i> Template</div>
              <div class="box">
                Ger Vars
                <textarea df-template></textarea>
                Output template with vars
              </div>
            </div>
            `,!1);break;case"multiple":var s=`
            <div>
              <div class="box">
                Multiple!
              </div>
            </div>
            `;this.drawflow.addNode("multiple",3,4,g,f,"multiple",{},s,!1);break;case"personalized":this.drawflow.addNode("personalized",1,1,g,f,"personalized",{},`
            <div>
              Personalized
            </div>
            `,!1);break;case"dbclick":this.drawflow.addNode("dbclick",1,1,g,f,"dbclick",{name:""},`
            <div>
            <div class="title-box"><i class="fas fa-mouse"></i> Db Click</div>
              <div class="box dbclickbox" ondblclick="showpopup(event)">
                Db Click here
                <div class="modal" style="display:none">
                  <div class="modal-content">
                    <span class="close" onclick="closemodal(event)">&times;</span>
                    Change your variable {name} !
                    <input type="text" df-name>
                  </div>
                </div>
              </div>
            </div>
            `,!1);break;default:}}static \u0275fac=function(g){return new(g||Q)};static \u0275cmp=ie({type:Q,selectors:[["app-no-code-canvas"]],viewQuery:function(g,f){if(g&1&&oe(pe,7),g&2){let w;ae(w=le())&&(f.drawflowContainer=w.first)}},decls:53,vars:0,consts:[["container",""],[1,"wrapper"],[1,"col"],["draggable","true","data-node","facebook",1,"drag-drawflow",3,"dragstart"],[1,"fab","fa-facebook"],["draggable","true","data-node","slack",1,"drag-drawflow",3,"dragstart"],[1,"fab","fa-slack"],["draggable","true","data-node","github",1,"drag-drawflow",3,"dragstart"],[1,"fab","fa-github"],["draggable","true","data-node","telegram",1,"drag-drawflow",3,"dragstart"],[1,"fab","fa-telegram"],["draggable","true","data-node","aws",1,"drag-drawflow",3,"dragstart"],[1,"fab","fa-aws"],["draggable","true","data-node","log",1,"drag-drawflow",3,"dragstart"],[1,"fas","fa-file-signature"],["draggable","true","data-node","google",1,"drag-drawflow",3,"dragstart"],[1,"fab","fa-google-drive"],["draggable","true","data-node","email",1,"drag-drawflow",3,"dragstart"],[1,"fas","fa-at"],["draggable","true","data-node","template",1,"drag-drawflow",3,"dragstart"],[1,"fas","fa-code"],["draggable","true","data-node","multiple",1,"drag-drawflow",3,"dragstart"],[1,"fas","fa-code-branch"],["draggable","true","data-node","personalized",1,"drag-drawflow",3,"dragstart"],[1,"fas","fa-fill"],["draggable","true","data-node","dbclick",1,"drag-drawflow",3,"dragstart"],[1,"fas","fa-mouse"],[1,"canvas"],["id","drawflow",3,"drop","dragover"]],template:function(g,f){if(g&1){let w=se();L(0,"div",1)(1,"div",2)(2,"div",3),j("dragstart",function(t){return T(w),O(f.drag(t))}),F(3,"i",4),L(4,"span"),P(5," Facebook"),W()(),L(6,"div",5),j("dragstart",function(t){return T(w),O(f.drag(t))}),F(7,"i",6),L(8,"span"),P(9," Slack receive message"),W()(),L(10,"div",7),j("dragstart",function(t){return T(w),O(f.drag(t))}),F(11,"i",8),L(12,"span"),P(13," Github Star"),W()(),L(14,"div",9),j("dragstart",function(t){return T(w),O(f.drag(t))}),F(15,"i",10),L(16,"span"),P(17," Telegram send message"),W()(),L(18,"div",11),j("dragstart",function(t){return T(w),O(f.drag(t))}),F(19,"i",12),L(20,"span"),P(21," AWS"),W()(),L(22,"div",13),j("dragstart",function(t){return T(w),O(f.drag(t))}),F(23,"i",14),L(24,"span"),P(25," File Log"),W()(),L(26,"div",15),j("dragstart",function(t){return T(w),O(f.drag(t))}),F(27,"i",16),L(28,"span"),P(29," Google Drive save"),W()(),L(30,"div",17),j("dragstart",function(t){return T(w),O(f.drag(t))}),F(31,"i",18),L(32,"span"),P(33," Email send"),W()(),L(34,"div",19),j("dragstart",function(t){return T(w),O(f.drag(t))}),F(35,"i",20),L(36,"span"),P(37," Template"),W()(),L(38,"div",21),j("dragstart",function(t){return T(w),O(f.drag(t))}),F(39,"i",22),L(40,"span"),P(41," Multiple inputs/outputs"),W()(),L(42,"div",23),j("dragstart",function(t){return T(w),O(f.drag(t))}),F(43,"i",24),L(44,"span"),P(45," Personalized"),W()(),L(46,"div",25),j("dragstart",function(t){return T(w),O(f.drag(t))}),F(47,"i",26),L(48,"span"),P(49," DBClick!"),W()()(),L(50,"div",27)(51,"div",28,0),j("drop",function(t){return T(w),O(f.drop(t))})("dragover",function(t){return T(w),O(f.allowDrop(t))}),W()()()}},styles:[".wrapper[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;display:flex;border-radius:.625rem;border:1px solid #E4E9F2;overflow:hidden}.canvas[_ngcontent-%COMP%]{flex:1}"]})};export{re as a};
